diff --git a/Edu-Java/testResources/META-INF/plugin.xml b/Edu-Java/testResources/META-INF/plugin.xml
index c09e7e73d..5278ba576 100644
--- a/Edu-Java/testResources/META-INF/plugin.xml
+++ b/Edu-Java/testResources/META-INF/plugin.xml
@@ -1,5 +1,6 @@
 <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
     <id>com.jetbrains.edu.java</id>
+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
     <depends optional="true" config-file="Edu-Java.xml">com.intellij.modules.java</depends>
 
     <extensions defaultExtensionNs="Educational">
diff --git a/Edu-Kotlin/testResources/META-INF/plugin.xml b/Edu-Kotlin/testResources/META-INF/plugin.xml
index 1f4d26990..c9fb71c71 100644
--- a/Edu-Kotlin/testResources/META-INF/plugin.xml
+++ b/Edu-Kotlin/testResources/META-INF/plugin.xml
@@ -1,5 +1,6 @@
 <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
     <id>com.jetbrains.edu.kotlin</id>
+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
     <depends optional="true" config-file="Edu-Kotlin.xml">com.intellij.modules.java</depends>
 
     <extensions defaultExtensionNs="Educational">
diff --git a/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java b/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java
index 626f6bc01..297f539d5 100644
--- a/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java
+++ b/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java
@@ -81,14 +81,14 @@ public class PyCourseProjectGenerator extends CourseProjectGenerator<PyNewProjec
           final PyPackageManager packageManager = PyPackageManager.getInstance(baseSdk);
           return packageManager.createVirtualEnv(virtualEnvPath, false);
         }
-      }, getAllSdks(), baseSdk, project.getBasePath(), null);
+      }, getAllSdks(), baseSdk, project.getBasePath());
       if (sdk == null) {
         LOG.warn("Failed to create virtual env in " + virtualEnvPath);
         return;
       }
       settings.setSdk(sdk);
       SdkConfigurationUtil.addSdk(sdk);
-      PySdkExtKt.associateWithModule(sdk, null, project.getBasePath());
+      PySdkExtKt.associateWithProject(sdk, project, false);
     }
   }
 
diff --git a/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt b/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt
index c171bcc49..bcef799f6 100644
--- a/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt
+++ b/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt
@@ -17,7 +17,7 @@ internal class PyLanguageSettings : PyLanguageSettings() {
       if (it != null && PythonSdkType.isVirtualEnv(it)) {
         val data = it.sdkAdditionalData as PythonSdkAdditionalData?
         if (data != null) {
-          val path = data.associatedModulePath
+          val path = data.associatedProjectPath
           if (path != null) {
             return@removeIf true
           }
@@ -27,7 +27,7 @@ internal class PyLanguageSettings : PyLanguageSettings() {
     }
 
     val sdks = if (fakeSdk != null) ContainerUtil.prepend(registeredSdks, fakeSdk) else registeredSdks
-    val sdkChooser = PythonSdkChooserCombo(null, null, sdks, null) { true }
+    val sdkChooser = PythonSdkChooserCombo(null, sdks, null) { true }
     sdkChooser.addChangedListener {
       mySettings.sdk = sdkChooser.comboBox.selectedItem as? Sdk
       notifyListeners()
diff --git a/Edu-Python/testResources/META-INF/plugin.xml b/Edu-Python/testResources/META-INF/plugin.xml
index 5c7158398..a20004f8c 100644
--- a/Edu-Python/testResources/META-INF/plugin.xml
+++ b/Edu-Python/testResources/META-INF/plugin.xml
@@ -1,4 +1,5 @@
 <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
     <id>com.jetbrains.edu.python</id>
+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
     <depends optional="true" config-file="Edu-Python.xml">com.intellij.modules.python</depends>
 </idea-plugin>
diff --git a/Edu-Scala/testResources/META-INF/plugin.xml b/Edu-Scala/testResources/META-INF/plugin.xml
index 5eca860a3..edce8141e 100644
--- a/Edu-Scala/testResources/META-INF/plugin.xml
+++ b/Edu-Scala/testResources/META-INF/plugin.xml
@@ -1,4 +1,5 @@
 <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
     <id>com.jetbrains.edu.scala</id>
+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
     <depends optional="true" config-file="Edu-Scala.xml">org.intellij.scala</depends>
 </idea-plugin>
diff --git a/build.gradle b/build.gradle
index 6049767e3..d706a437b 100644
--- a/build.gradle
+++ b/build.gradle
@@ -122,10 +122,10 @@ allprojects {
     }
 
     intellij {
-        if (project.hasProperty("ideaVersion")) {
-            version ideaVersion
-        } else if (project.hasProperty("ideaPath")) {
-            localPath ideaPath
+        if (project.hasProperty("androidStudioPath")) {
+            localPath androidStudioPath
+        } else {
+            localPath downloadStudioIfNeededAndGetPath()
         }
     }
 
@@ -192,7 +192,7 @@ intellij {
     pluginName 'EduTools'
     updateSinceUntilBuild true
     downloadSources false
-    plugins 'junit', 'Kotlin', "PythonCore:$pythonPluginVersion", "org.intellij.scala:$scalaPluginVersion", "NodeJS:$nodeJsPluginVersion", "JavaScriptLanguage"
+    plugins 'junit', 'Kotlin', "PythonCore:$pythonPluginVersion", "org.intellij.scala:$scalaPluginVersion"
 }
 
 task configurePyCharm {
@@ -271,7 +271,7 @@ configure(project(':educational-core')) {
     }
 }
 
-configure([project(':Edu-Python'), project(':Edu-Java'), project(':Edu-Kotlin'), project(':Edu-Scala'), project(':Edu-Android'), project(':Edu-JavaScript')]) {
+configure([project(':Edu-Python'), project(':Edu-Java'), project(':Edu-Kotlin'), project(':Edu-Scala'), project(':Edu-Android')]) {
     dependencies {
         compile project(':educational-core')
         testCompile project(':educational-core').sourceSets.test.output
@@ -279,11 +279,11 @@ configure([project(':Edu-Python'), project(':Edu-Java'), project(':Edu-Kotlin'),
 }
 
 configure([project(':educational-core'), project(':Edu-Java')]) {
-    intellij.plugins 'junit', 'properties', 'gradle', 'Groovy'
+    intellij.plugins 'junit', 'properties', 'gradle', 'Groovy', 'smali'
 }
 
 configure(project(':Edu-Kotlin')) {
-    intellij.plugins 'junit', 'Kotlin', 'properties','gradle', 'Groovy'
+    intellij.plugins 'junit', 'Kotlin', 'properties','gradle', 'Groovy', 'smali'
 
 
     task createTwitterProperties() {
@@ -314,33 +314,18 @@ configure(project(':Edu-Python')) {
 }
 
 configure(project(':Edu-Scala')) {
-    intellij.plugins "org.intellij.scala:$scalaPluginVersion", 'junit', 'properties', 'gradle', 'Groovy'
+    intellij.plugins "org.intellij.scala:$scalaPluginVersion", 'junit', 'properties', 'gradle', 'Groovy', 'smali'
 }
 
 configure(project(':Edu-Android')) {
     intellij.plugins 'junit', 'properties', 'android', 'gradle', 'Groovy', 'IntelliLang', 'smali'
 }
 
-configure(project(':Edu-JavaScript')) {
-  task createCheckiOOAuthProperties() {
-    createProperties(
-      "${projectDir}/resources/checkio/js-checkio-oauth.properties",
-      [
-        "jsCheckioClientId" : jsCheckioClientId,
-        "jsCheckioClientSecret" : jsCheckioClientSecret
-      ]
-    )
-  }
-  processResources.dependsOn(createCheckiOOAuthProperties)
-
-  intellij.plugins "NodeJS:$nodeJsPluginVersion", "JavaScriptLanguage"
-}
-
 runIde.systemProperty("-Didea.is.internal", "true")
 runIde.systemProperty("-ea", "")
 
 dependencies {
-    compile project(':educational-core'), project(':Edu-Python'), project(':Edu-Kotlin'), project(':Edu-Java'), project(':Edu-Scala'), project(':Edu-Android'), project(':Edu-JavaScript')
+    compile project(':educational-core'), project(':Edu-Python'), project(':Edu-Kotlin'), project(':Edu-Java'), project(':Edu-Scala'), project(':Edu-Android')
 }
 
 idea {
diff --git a/educational-core/src/icons/EducationalCoreIcons.java b/educational-core/src/icons/EducationalCoreIcons.java
index 4b7a5a870..a4af4fe72 100644
--- a/educational-core/src/icons/EducationalCoreIcons.java
+++ b/educational-core/src/icons/EducationalCoreIcons.java
@@ -39,5 +39,5 @@ public class EducationalCoreIcons {
 
   public static final Icon CourseAction = load("/icons/com/jetbrains/edu/eduCourseAction.png"); // 16x16
   public static final Icon CourseTree = load("/icons/com/jetbrains/edu/eduCourseTree.png"); // 16x16
-  public static final Icon CourseToolWindow = load("/icons/com/jetbrains/edu/eduCourseTask.svg"); // 13x13
+  public static final Icon CourseToolWindow = load("/icons/com/jetbrains/edu/eduCourseTask181.png"); // 13x13
 }
diff --git a/patcher/studio-181.patch b/patcher/studio-181.patch
index 0b6dccee9..94ed7850f 100644
--- a/patcher/studio-181.patch
+++ b/patcher/studio-181.patch
@@ -1,150 +0,0 @@
-diff --git a/Edu-Java/testResources/META-INF/plugin.xml b/Edu-Java/testResources/META-INF/plugin.xml
-index c09e7e7..5278ba5 100644
---- a/Edu-Java/testResources/META-INF/plugin.xml
-+++ b/Edu-Java/testResources/META-INF/plugin.xml
-@@ -1,5 +1,6 @@
- <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
-     <id>com.jetbrains.edu.java</id>
-+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
-     <depends optional="true" config-file="Edu-Java.xml">com.intellij.modules.java</depends>
-
-     <extensions defaultExtensionNs="Educational">
-diff --git a/Edu-Kotlin/testResources/META-INF/plugin.xml b/Edu-Kotlin/testResources/META-INF/plugin.xml
-index 1f4d269..c9fb71c 100644
---- a/Edu-Kotlin/testResources/META-INF/plugin.xml
-+++ b/Edu-Kotlin/testResources/META-INF/plugin.xml
-@@ -1,5 +1,6 @@
- <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
-     <id>com.jetbrains.edu.kotlin</id>
-+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
-     <depends optional="true" config-file="Edu-Kotlin.xml">com.intellij.modules.java</depends>
-
-     <extensions defaultExtensionNs="Educational">
-diff --git a/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java b/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java
-index 5e2f41e..e825027 100644
---- a/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java
-+++ b/Edu-Python/src/com/jetbrains/edu/python/learning/newproject/PyCourseProjectGenerator.java
-@@ -81,14 +81,14 @@ public class PyCourseProjectGenerator extends CourseProjectGenerator<PyNewProjec
-           final PyPackageManager packageManager = PyPackageManager.getInstance(baseSdk);
-           return packageManager.createVirtualEnv(virtualEnvPath, false);
-         }
--      }, getAllSdks(), baseSdk, project.getBasePath(), null);
-+      }, getAllSdks(), baseSdk, project.getBasePath());
-       if (sdk == null) {
-         LOG.warn("Failed to create virtual env in " + virtualEnvPath);
-         return;
-       }
-       settings.setSdk(sdk);
-       SdkConfigurationUtil.addSdk(sdk);
--      PySdkExtKt.associateWithModule(sdk, null, project.getBasePath());
-+      PySdkExtKt.associateWithProject(sdk, project, false);
-     }
-   }
-
-diff --git a/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt b/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt
-index c171bcc..bcef799 100644
---- a/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt
-+++ b/Edu-Python/src/com/jetbrains/edu/python/learning/pycharm/PyLanguageSettings.kt
-@@ -17,7 +17,7 @@ internal class PyLanguageSettings : PyLanguageSettings() {
-       if (it != null && PythonSdkType.isVirtualEnv(it)) {
-         val data = it.sdkAdditionalData as PythonSdkAdditionalData?
-         if (data != null) {
--          val path = data.associatedModulePath
-+          val path = data.associatedProjectPath
-           if (path != null) {
-             return@removeIf true
-           }
-@@ -27,7 +27,7 @@ internal class PyLanguageSettings : PyLanguageSettings() {
-     }
-
-     val sdks = if (fakeSdk != null) ContainerUtil.prepend(registeredSdks, fakeSdk) else registeredSdks
--    val sdkChooser = PythonSdkChooserCombo(null, null, sdks, null) { true }
-+    val sdkChooser = PythonSdkChooserCombo(null, sdks, null) { true }
-     sdkChooser.addChangedListener {
-       mySettings.sdk = sdkChooser.comboBox.selectedItem as? Sdk
-       notifyListeners()
-diff --git a/Edu-Python/testResources/META-INF/plugin.xml b/Edu-Python/testResources/META-INF/plugin.xml
-index 5c71583..a20004f 100644
---- a/Edu-Python/testResources/META-INF/plugin.xml
-+++ b/Edu-Python/testResources/META-INF/plugin.xml
-@@ -1,4 +1,5 @@
- <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
-     <id>com.jetbrains.edu.python</id>
-+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
-     <depends optional="true" config-file="Edu-Python.xml">com.intellij.modules.python</depends>
- </idea-plugin>
-diff --git a/Edu-Scala/testResources/META-INF/plugin.xml b/Edu-Scala/testResources/META-INF/plugin.xml
-index 5eca860..edce814 100644
---- a/Edu-Scala/testResources/META-INF/plugin.xml
-+++ b/Edu-Scala/testResources/META-INF/plugin.xml
-@@ -1,4 +1,5 @@
- <idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude">
-     <id>com.jetbrains.edu.scala</id>
-+    <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
-     <depends optional="true" config-file="Edu-Scala.xml">org.intellij.scala</depends>
- </idea-plugin>
-diff --git a/build.gradle b/build.gradle
-index 5390f1b..20b4e8f 100644
---- a/build.gradle
-+++ b/build.gradle
-@@ -112,10 +112,10 @@ allprojects {
-     }
-
-     intellij {
--        if (project.hasProperty("ideaVersion")) {
--            version ideaVersion
--        } else if (project.hasProperty("ideaPath")) {
--            localPath ideaPath
-+        if (project.hasProperty("androidStudioPath")) {
-+            localPath androidStudioPath
-+        } else {
-+            localPath downloadStudioIfNeededAndGetPath()
-         }
-     }
-
-@@ -265,11 +265,11 @@ configure([project(':Edu-Python'), project(':Edu-Java'), project(':Edu-Kotlin'),
- }
-
- configure([project(':educational-core'), project(':Edu-Java')]) {
--    intellij.plugins 'junit', 'properties', 'gradle', 'Groovy'
-+    intellij.plugins 'junit', 'properties', 'gradle', 'Groovy', 'smali'
- }
-
- configure(project(':Edu-Kotlin')) {
--    intellij.plugins 'junit', 'Kotlin', 'properties','gradle', 'Groovy'
-+    intellij.plugins 'junit', 'Kotlin', 'properties','gradle', 'Groovy', 'smali'
-
-
-     task createTwitterProperties() {
-@@ -287,7 +287,7 @@ configure(project(':Edu-Python')) {
- }
-
- configure(project(':Edu-Scala')) {
--    intellij.plugins "org.intellij.scala:$scalaPluginVersion", 'junit', 'properties', 'gradle', 'Groovy'
-+    intellij.plugins "org.intellij.scala:$scalaPluginVersion", 'junit', 'properties', 'gradle', 'Groovy', 'smali'
- }
-
- configure(project(':Edu-Android')) {
-diff --git a/educational-core/src/icons/EducationalCoreIcons.java b/educational-core/src/icons/EducationalCoreIcons.java
-index a9c1908..8416b7c 100644
---- a/educational-core/src/icons/EducationalCoreIcons.java
-+++ b/educational-core/src/icons/EducationalCoreIcons.java
-@@ -37,5 +37,5 @@ public class EducationalCoreIcons {
-
-   public static final Icon CourseAction = load("/icons/com/jetbrains/edu/eduCourseAction.png"); // 16x16
-   public static final Icon CourseTree = load("/icons/com/jetbrains/edu/eduCourseTree.png"); // 16x16
--  public static final Icon CourseToolWindow = load("/icons/com/jetbrains/edu/eduCourseTask.svg"); // 13x13
-+  public static final Icon CourseToolWindow = load("/icons/com/jetbrains/edu/eduCourseTask181.png"); // 13x13
- }
-diff --git a/resources/META-INF/plugin.xml b/resources/META-INF/plugin.xml
-index 93c3939..aae2638 100644
---- a/resources/META-INF/plugin.xml
-+++ b/resources/META-INF/plugin.xml
-@@ -8,6 +8,7 @@
-     <!--update changes in changes.html file instead-->
-     <change-notes/>
-     <depends>com.intellij.modules.lang</depends>
-+    <depends>com.intellij.modules.androidstudio</depends>
- 
-     <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
-     <depends optional="true" config-file="Edu-Scala.xml">org.intellij.scala</depends>
diff --git a/resources/META-INF/plugin.xml b/resources/META-INF/plugin.xml
index 791d717b8..60d371ea1 100644
--- a/resources/META-INF/plugin.xml
+++ b/resources/META-INF/plugin.xml
@@ -8,6 +8,7 @@
     <!--update changes in changes.html file instead-->
     <change-notes/>
     <depends>com.intellij.modules.lang</depends>
+    <depends>com.intellij.modules.androidstudio</depends>
 
     <xi:include href="/META-INF/educational-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
     <depends optional="true" config-file="Edu-Scala.xml">org.intellij.scala</depends>
diff --git a/settings.gradle b/settings.gradle
index b120c4d1e..1d02a34bc 100644
--- a/settings.gradle
+++ b/settings.gradle
@@ -1,2 +1,2 @@
 rootProject.name = 'educational-plugin'
-include 'Edu-Java', 'Edu-Scala', 'Edu-Kotlin', 'Edu-Python', 'educational-core', 'Edu-Android', 'Edu-JavaScript'
\ No newline at end of file
+include 'Edu-Java', 'Edu-Scala', 'Edu-Kotlin', 'Edu-Python', 'educational-core', 'Edu-Android'
\ No newline at end of file
